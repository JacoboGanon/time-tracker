# Time Tracker Product Plan (Internal, Client-Facing Reports)

## 1) Product Scope

Build an internal time-tracking app where team members can:

- track time with a live stopwatch and manual entries
- edit entries later when they forget to track in real time
- log work by client and project
- collaborate with other team members on shared projects
- capture per-person effort and activity details
- generate polished reports for clients (dashboard + PDF export)

Clients do not log in. They only receive final exported reports.

## 2) Confirmed Decisions

- Audience: Internal team use only (single organization)
- Time capture: Stopwatch + manual entries
- Editability: Past entries can be modified
- Trust model: No screenshot/activity monitoring
- Approval flow: Not required
- Billing rates: Default by person, with per-project override support
- Reporting outputs (MVP): Internal dashboard + PDF export
- Compliance constraints now: None explicitly required

## 3) Recommended Industry Practices

- Keep immutable audit history for critical changes (duration, date, project, rates), even if edits are allowed.
- Store all timestamps in UTC and render in user time zone.
- Separate "time tracked" from "amount billed" to preserve accounting flexibility.
- Use explicit role-based permissions (`owner`, `manager`, `member`, `viewer`) at project level.
- Add report snapshot versioning so exported PDFs can be reproduced exactly later.
- Establish a weekly reminder flow for missing time entries.

## 4) Domain Model (MVP + Near-Term)

Core entities:

- `User`: Team member
- `Client`: Service recipient organization
- `Project`: Work container under one client
- `ProjectMember`: User-to-project membership with role
- `ActivityType`: Category of work (development, meeting, support, etc.)
- `TimeEntry`: Who did what, when, how long, notes, billable flag
- `RateCard`: Default hourly rate by user
- `ProjectRateOverride`: Optional user+project override rate
- `Report`: Generated report metadata (period, filters, generated by)
- `ReportSnapshot`: Frozen totals/source references used for exported PDF
- `TimeEntryAudit`: Field-level change log for edited entries

Essential `TimeEntry` fields:

- `id`, `userId`, `clientId`, `projectId`, `activityTypeId`
- `startAt`, `endAt`, `durationMinutes`
- `description`
- `isBillable`
- `createdAt`, `updatedAt`

## 5) High-Level Architecture

- Frontend: Next.js App Router + server components where useful
- API: tRPC routers for typed contracts
- Data: Prisma + PostgreSQL
- Auth: Better Auth (already scaffolded)
- Reporting: Server-side aggregation + PDF generator service/module

Suggested modules:

- `src/server/api/routers/client.ts`
- `src/server/api/routers/project.ts`
- `src/server/api/routers/time-entry.ts`
- `src/server/api/routers/report.ts`
- `src/server/services/reporting/*`
- `src/server/services/rates/*`

## 6) Milestone Plan

### Milestone A: Foundation and Data Model

Goal: Establish schema and permissions foundation.

Deliverables:

- Prisma schema for clients, projects, memberships, activity types, time entries, rates, audits
- Seed data for initial activity types and local demos
- Base tRPC routers with CRUD for client/project/member/activity type
- Role checks in API layer

Acceptance criteria:

- Can create client, project, and assign members with roles
- Permissions enforce edit/view boundaries by role
- Schema supports user default rate + project override rate

### Milestone B: Time Tracking UX

Goal: Reliable daily tracking workflows.

Deliverables:

- Live stopwatch start/stop UI
- Manual entry create/edit/delete UI
- Inline validation (end >= start, no zero/negative duration)
- Entry list with filters (date range, project, member, activity)
- Edit audit creation on important field changes

Acceptance criteria:

- User can track with stopwatch or create manual entry
- Past entries can be edited and audit records are retained
- Team member totals visible by project and date range

### Milestone C: Rates and Costing

Goal: Convert tracked effort into consistent billing totals.

Deliverables:

- User default hourly rate management
- Project-specific rate override per user
- Aggregation service for billable totals

Acceptance criteria:

- Report calculations prefer project override, fallback to user default
- Billable totals are reproducible for same filter inputs

### Milestone D: Reporting and Exports

Goal: Client-ready reporting output.

Deliverables:

- Internal reporting dashboard
- Filters: client, project, date range, member, activity
- Grouped summaries by project/member/activity
- PDF export with branding-ready layout
- Report metadata persistence (who generated, when, filters)

Acceptance criteria:

- Team can generate and export a polished PDF report
- Dashboard totals and PDF totals match for same filters
- Historical generated reports remain accessible

### Milestone E: Operational Hardening

Goal: Improve reliability and maintainability.

Deliverables:

- Reminder jobs for missing time entries
- Empty/loading/error states for key pages
- Basic observability (API errors, export failures)
- Performance pass for report queries and indexes

Acceptance criteria:

- Missing-time reminders work for configured schedule
- Typical dashboard/report queries perform within acceptable thresholds

## 7) Testing Strategy (TDD by Default)

Per feature:

1. Write failing tests first (unit/integration based on behavior).
2. Confirm failure reason matches intended gap.
3. Implement minimal code to pass.
4. Re-run tests, then run lint + type-check.

Suggested test coverage:

- Permission checks by role
- Time entry duration and overlap validation rules
- Rate resolution logic (override vs default fallback)
- Report aggregation correctness
- PDF export smoke test (generated document contains expected sections)

## 8) Definition of Done (Per Milestone)

- Feature tests added and passing
- `npm run lint` passes
- `npm run typecheck` passes
- Docs/checklist updated
- No critical accessibility regressions on new UI surfaces

## 9) Open Product Clarifications

- Determine exact project roles and role capabilities for MVP (`manager` edit scope vs `member` scope).
- Confirm whether overlapping entries are allowed for a single user.
- Confirm if non-billable entries should appear in client PDFs or be hidden by default.
- Define standard report template branding fields (logo, address block, footer text).
